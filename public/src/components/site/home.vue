<template>
  <div class="home">
    <nav-bar is-fixed="true"></nav-bar>

    <div class="content-wrapper header">
      <div class="content name">

        <div class="intro">
          <h2>Who_Am_I = (<a href="https://github.com/stanjhae"
                        target="_blank" rel="me">Chijindu_Orji</a>) => ({</h2>
        </div>

        <div class="splash">
          <div class="clip cd-headline splash-text">
            <span>I am a </span>
            <span class="cd-words-wrapper">
              <b class="is-visible">Full-stack Developer</b>
              <b>Lifelong Learner</b>
              <b>Creative Problem Solver</b>
            </span>
          </div>
          <div class="clip cd-headline splash-text">
            <span>I am a </span>
            <span class="cd-words-wrapper">
              <b class="is-visible">Team Player</b>
              <b>Manchester United Fan</b>
              <b>Nigerian Citizen</b>
            </span>
          </div>
          <div class="clip cd-headline splash-text">
            <span>I am an</span>
            <span class="cd-words-wrapper">
              <b class="is-visible">Entrepreneur</b>
              <b>Environmental Advocate</b>
            </span>
          </div>
        </div>

        <div class="intro">
          <h2>})</h2>
        </div>

      </div>
    </div>
    <div class="content-wrapper">
      <div class="content">

        <div class="intro">
          <h2><span class="green">Specialties</span> = (<a href="https://github.com/stanjhae"
                                  target="_blank" rel="me">props</a>) => ({</h2>
        </div>

        <div class="splash">
          <div class="cd-headline splash-text">
            <span>Mobile Apps</span>
          </div>
          <div class="cd-headline splash-text">
            <span>Web Apps</span>
          </div>
        </div>

        <div class="intro">
          <h2>})</h2>
        </div>
      </div>

      <div class="content">

        <div class="intro">
          <h2><span class="green">Skills</span>.forEach(<a href="https://github.com/stanjhae"
                                   target="_blank" rel="me">skill</a> => ({</h2>
        </div>

        <div class="splash">
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 90%;">
                  <p>Html/Css</p>
                  <p class="percent" style="right: 15%;">90%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 86%;">
                  <p>React</p>
                  <p class="percent" style="right: 19%;">86%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 80%;">
                  <p>React Native</p>
                  <p class="percent" style="right: 25%;">80%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 75%;">
                  <p>Express.js</p>
                  <p class="percent" style="right: 30%;">75%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 88%;">
                  <p>MongoDB</p>
                  <p class="percent" style="right: 17%;">88%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 90%;">
                  <p>C</p>
                  <p class="percent" style="right: 15%;">90%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 90%;">
                  <p>Node.js</p>
                  <p class="percent" style="right: 15%;">90%</p>
                </div>
              </div>
            </div>
          </div>
          <div class="cd-headline splash-text">
            <div class="fancyProgressBar">
              <div class="contain">
                <div class="progressDone" style="width: 85%;">
                  <p>Python</p>
                  <p class="percent" style="right: 20%;">85%</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="intro">
          <h2>})</h2>
        </div>

      </div>
    </div>

    <div class="content-wrapper">
      <div class="content">

        <div class="intro">
          <h2><span class="green">Projects</span>.forEach(<a href="https://github.com/stanjhae"
                        target="_blank" rel="me">project</a> => ({</h2>
        </div>

        <div class="splash">
          <div class="cd-headline splash-text">
            <span>DebMUN - <a href="https://debmun.com"
                     target="_blank" rel="me">www.debmun.com</a></span>
          </div>
          <div class="cd-headline splash-text">
            <span>JEHU - <a href="https://jehu-deb.firebaseapp.com"
                     target="_blank" rel="me">www.jehu.com</a></span>
          </div>
        </div>

        <div class="intro">
          <h2>})</h2>
        </div>

      </div>

      <div class="content">

        <div class="intro">
          <h2><span class="green">Hobbies</span>.forEach(<a href="https://github.com/stanjhae"
                                 target="_blank" rel="me">hobby</a> => ({</h2>
        </div>
        <div class="hobbies">
          <div class="cd-headline splash-text">
            <i class="fa fa-music green" aria-hidden="true"></i>
            <span>Music</span>
          </div>
          <div class="cd-headline splash-text">
            <i class="fa fa-laptop green" aria-hidden="true"></i>
            <span>Programming</span>
          </div>
          <div class="cd-headline splash-text">
            <i class="fa fa-gamepad green" aria-hidden="true"></i>
            <span>Gaming</span>
          </div>
        </div>
        <div class="intro">
          <h2>})</h2>
        </div>

      </div>
    </div>

    <div class="content-wrapper footer">
      <div class="content name">

        <div class="intro">
          <h2>Contact_Me = (<a href="https://github.com/stanjhae"
                                  target="_blank" rel="me">@stanjhae</a>) => ({</h2>
        </div>

        <div class="splash">
          <div class="cd-headline splash-text">
            <span>Github - <a href="https://debmun.com"
                              target="_blank" rel="me">stanjhae</a></span>
          </div>
          <div class="cd-headline splash-text">
            <span>LinkedIn - <a href="https://jehu-deb.firebaseapp.com"
                            target="_blank" rel="me">Chijindu Orji</a></span>
          </div>
        </div>

        <div class="intro">
          <h2>})</h2>
        </div>

      </div>
    </div>

  </div>
</template>

<script>
import Nav from "./nav.vue";

const DEFAULT_TEXT = "I'm a full-stack developer and Computer " +
    "Science major at Rochester Institute of Technology. Check out " +
    "my work on Github, follow me on Medium or connect on LinkedIn.";

export default{
  data(){
    return {
      text: "",
      traits: []
    };
  },

  components: {
    "nav-bar": Nav
  },

  methods: {
    /**
     * Generates a single item from a list along
     * with an index representing it's position
     * in a list of length 3.
     *
     * @return {IterableIterator<{text: string, index: number}>}
     */
    *genTraits(){
      let index = 0;
      let partition = 3; // three traits per section
      let traits = [
        "Full-stack Developer", "Entrepreneur", "Lifelong Learner",
        "Growth Mindset", "Creative Problem Solver", "Team Player",
        "Open-source Enthusiast", "Manchester United Fan", "Humanitarian",
        "Humorist", "Environmental Advocate", "Nigerian Citizen"
      ];

      while (index < traits.length){
        yield {text: traits[index], index: index % partition};

        if (++index === traits.length) index = 0;
      }
    },

    /**
     * Adds a generated trait to the list
     * of traits at the specified index.
     *
     * @param traits - Trait generator
     */
    newTrait(traits){
      let trait = traits.next().value;

      this.traits.splice(trait.index, 1, trait.text);
    },

    /**
     * Track all the links on the
     * homepage with google analytics
     */
    analytics(){
      let self = this;
      let anchors = [
        {selector: ".intro a", type: "Title Link"},
        {selector: ".links a", type: "Icon Link"}
      ];

      for (let a of anchors){
        $(a.selector).click(function(){
          let url = $(this).attr("href");
          self.$ga.event(`Home - ${a.type}`, "open", url);
        });
      }
    }
  },

  async created(){
    let self = this;
    let traits = self.genTraits();
    let partition = 3;
    let i = 0;

    // Generate first set of traits
    while(i++ < partition){
      self.newTrait(traits);
    }

    // Get a new trait every 2 seconds
    setInterval(() => {self.newTrait(traits);}, 2000);

    try{
      let res = await self.$http.get("/api/h");

      self.text = res.body.result.home.text;
    }
    catch(err){
      self.text = DEFAULT_TEXT;
    }

    // analytics
    self.$nextTick(() => {
      self.analytics();
      jQuery(document).ready(function($){
        //set animation timing
        var animationDelay = 2500,
          //loading bar effect
          barAnimationDelay = 3800,
          barWaiting = barAnimationDelay - 3000, //3000 is the duration of the transition on the loading bar - set in the scss/css file
          //letters effect
          lettersDelay = 50,
          //type effect
          typeLettersDelay = 150,
          selectionDuration = 500,
          typeAnimationDelay = selectionDuration + 800,
          //clip effect
          revealDuration = 1000,
          revealAnimationDelay = 3500;

        initHeadline();


        function initHeadline() {
          //insert <i> element for each letter of a changing word
          singleLetters($(".cd-headline.letters").find("b"));
          //initialise headline animation
          animateHeadline($(".cd-headline"));
        }

        function singleLetters($words) {
          $words.each(function(){
            var word = $(this),
              letters = word.text().split(""),
              selected = word.hasClass("is-visible");
            for (i in letters) {
              if(word.parents(".rotate-2").length > 0) letters[i] = "<em>" + letters[i] + "</em>";
              letters[i] = (selected) ? "<i class=\"in\">" + letters[i] + "</i>": "<i>" + letters[i] + "</i>";
            }
            var newLetters = letters.join("");
            word.html(newLetters).css("opacity", 1);
          });
        }

        function animateHeadline($headlines) {
          var duration = animationDelay;
          $headlines.each(function(){
            var headline = $(this);

            if(headline.hasClass("loading-bar")) {
              duration = barAnimationDelay;
              setTimeout(function(){ headline.find(".cd-words-wrapper").addClass("is-loading"); }, barWaiting);
            } else if (headline.hasClass("clip")){
              var spanWrapper = headline.find(".cd-words-wrapper"),
                newWidth = spanWrapper.width() + 10;
              spanWrapper.css("width", newWidth);
            } else if (!headline.hasClass("type") ) {
              //assign to .cd-words-wrapper the width of its longest word
              var words = headline.find(".cd-words-wrapper b"),
                width = 0;
              words.each(function(){
                var wordWidth = $(this).width();
                if (wordWidth > width) width = wordWidth;
              });
              headline.find(".cd-words-wrapper").css("width", width);
            }

            //trigger animation
            setTimeout(function(){ hideWord( headline.find(".is-visible").eq(0) ); }, duration);
          });
        }

        function hideWord($word) {
          var nextWord = takeNext($word);

          if($word.parents(".cd-headline").hasClass("type")) {
            var parentSpan = $word.parent(".cd-words-wrapper");
            parentSpan.addClass("selected").removeClass("waiting");
            setTimeout(function(){
              parentSpan.removeClass("selected");
              $word.removeClass("is-visible").addClass("is-hidden").children("i").removeClass("in").addClass("out");
            }, selectionDuration);
            setTimeout(function(){ showWord(nextWord, typeLettersDelay); }, typeAnimationDelay);

          } else if($word.parents(".cd-headline").hasClass("letters")) {
            var bool = ($word.children("i").length >= nextWord.children("i").length) ? true : false;
            hideLetter($word.find("i").eq(0), $word, bool, lettersDelay);
            showLetter(nextWord.find("i").eq(0), nextWord, bool, lettersDelay);

          }  else if($word.parents(".cd-headline").hasClass("clip")) {
            $word.parents(".cd-words-wrapper").animate({ width : "2px" }, revealDuration, function(){
              switchWord($word, nextWord);
              showWord(nextWord);
            });

          } else if ($word.parents(".cd-headline").hasClass("loading-bar")){
            $word.parents(".cd-words-wrapper").removeClass("is-loading");
            switchWord($word, nextWord);
            setTimeout(function(){ hideWord(nextWord); }, barAnimationDelay);
            setTimeout(function(){ $word.parents(".cd-words-wrapper").addClass("is-loading"); }, barWaiting);

          } else {
            switchWord($word, nextWord);
            setTimeout(function(){ hideWord(nextWord); }, animationDelay);
          }
        }

        function showWord($word, $duration) {
          if($word.parents(".cd-headline").hasClass("type")) {
            showLetter($word.find("i").eq(0), $word, false, $duration);
            $word.addClass("is-visible").removeClass("is-hidden");

          }  else if($word.parents(".cd-headline").hasClass("clip")) {
            $word.parents(".cd-words-wrapper").animate({ "width" : $word.width() + 10 }, revealDuration, function(){
              setTimeout(function(){ hideWord($word); }, revealAnimationDelay);
            });
          }
        }

        function hideLetter($letter, $word, $bool, $duration) {
          $letter.removeClass("in").addClass("out");

          if(!$letter.is(":last-child")) {
            setTimeout(function(){ hideLetter($letter.next(), $word, $bool, $duration); }, $duration);
          } else if($bool) {
            setTimeout(function(){ hideWord(takeNext($word)); }, animationDelay);
          }

          if($letter.is(":last-child") && $("html").hasClass("no-csstransitions")) {
            var nextWord = takeNext($word);
            switchWord($word, nextWord);
          }
        }

        function showLetter($letter, $word, $bool, $duration) {
          $letter.addClass("in").removeClass("out");

          if(!$letter.is(":last-child")) {
            setTimeout(function(){ showLetter($letter.next(), $word, $bool, $duration); }, $duration);
          } else {
            if($word.parents(".cd-headline").hasClass("type")) { setTimeout(function(){ $word.parents(".cd-words-wrapper").addClass("waiting"); }, 200);}
            if(!$bool) { setTimeout(function(){ hideWord($word); }, animationDelay); }
          }
        }

        function takeNext($word) {
          return (!$word.is(":last-child")) ? $word.next() : $word.parent().children().eq(0);
        }

        function takePrev($word) {
          return (!$word.is(":first-child")) ? $word.prev() : $word.parent().children().last();
        }

        function switchWord($oldWord, $newWord) {
          $oldWord.removeClass("is-visible").addClass("is-hidden");
          $newWord.removeClass("is-hidden").addClass("is-visible");
        }
      });

    });
  },
};

</script>

<style scoped>
  .green{
    color: #42b983;
  }

  .home{
    width: 100%;
    max-width: 1920px;
    height: 100%;
    min-height: 100vh;
    margin: auto;
    display: flex;
    flex-direction: column;
    background-color: #fff;
  }

  .content-wrapper{
    width: 100%;
    min-height: fit-content;
    min-height: -moz-fit-content;
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    grid-auto-flow: column;
    color: #434343;
    margin-bottom: 50px;
  }

  .header{
    background-image: url("../../assets/img/headerImg.jpg");
    background-size: cover;
    height: 90vh;
  }

  .footer{
    background-image: url("../../assets/img/headerImg.jpg");
    background-size: cover;
    height: 30vh;
    margin-bottom: 0;
  }
  /*.content, .oj-image{*/
    /*height: 700px;*/
  /*}*/

  .content{
    display: flex;
    flex-shrink: 0;
    flex-direction: column;
    justify-content: space-between;
    min-height: 250px;
    margin-bottom: 50px;
    background-color: #F5F5F5;
  }

  .name{
    margin: 0;
    background-color: transparent;
    color: #fff;
  }

  .name h2, .name .cd-words-wrapper b, .name .splash-text span{
    color: #fff;
  }

  .content .intro{
    width: fit-content;
    width: -moz-fit-content;
    padding: 15px;
    /*font-family: "Assistant", cursive;*/
    font-family: Acme, cursive;
    font-size: 30px;
    font-weight: bold;
  }

  .content .intro h2{
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
  }

  .name .intro h2{
    font-size: inherit;
  }

  .content .intro a{
    font-family: Acme, cursive;
    text-decoration: none;
  }

  .content .intro a:hover{
    /*background-color: #f2f2f2;*/
  }

  .content .splash{
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    justify-content: space-evenly;
    /*height: 300px;*/
  }

  .content .splash-text{
    width: 350px;
    flex-shrink: 0;
    padding: 0px 15px 0px 60px;
    font-family: Acme, cursive;
    /*font-family: Quicksand, sans-serif;*/
    font-size: 18px;
    font-weight: bold;
    line-height: 2;
    color: #434343;
  }

  @media screen and (max-width: 1700px){
    .content{
      min-height: 250px;
      min-width: 410px;
    }
    .content, .oj-image{
      min-height: 250px;
    }

    .content .intro{
      font-size: 28px;
      padding: 10px;
    }

    .name .intro h2{
      font-size: 50px;
    }

    .name .splash b, .name .splash span{
      font-size: 20px;
    }
    /*.content .splash{*/
      /*height: 240px;*/
    /*}*/

    .content .splash-text{
      font-size: 18px;
      padding: 0px 0px 10px 60px;
    }

    .content .hobbies{
      display: flex;
      justify-content: space-around;
    }

    .content .hobbies .splash-text{
      width: auto;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

  }

  @media screen and (max-width: 1000px){
    /*.oj-image{*/
      /*display: none;*/
    /*}*/

    .content{
      margin-right: 0;
    }

    .content .splash-text{
      width: 300px;
    }
  }

  @media screen and (max-width: 640px){

    .content-wrapper{
      display: grid;
      grid-auto-flow: dense;
    }
    .oj-image{
      margin-top: 60px;
    }
    .nav-ghost{
      height: 110px;
    }

    /*.content{*/
      /*height: 250px;*/
    /*}*/

    .content .intro{
      font-size: 25px;
    }

    /*.content .splash{*/
      /*height: 300px;*/
    /*}*/

    .content .splash-text{
      font-size: 12px;
      width: 260px;
    }
  }

  .cd-words-wrapper {
    display: inline-block;
    position: relative;
    text-align: left;
  }
  .cd-words-wrapper b {
    display: inline-block;
    position: absolute;
    white-space: nowrap;
    left: 0;
    top: 0;
  }
  .cd-words-wrapper b.is-visible {
    position: relative;
  }

  span {
    display: inline-block;
    padding: .2em 0;
  }

  .cd-words-wrapper {
    overflow: hidden;
    vertical-align: top;
  }
  .cd-words-wrapper::after {
     /* line */
     content: '';
     position: absolute;
     top: 0;
     right: 0;
     width: 2px;
     height: 100%;
    background-color: #AEBCB9;
   }

  b {
    opacity: 0;
  }
  b.is-visible {
     opacity: 1;
   }

  .fancyProgressBar {
    width: 300px;
    background-size: 40px 20px;
    background-position: -1px 0px;
    position: relative;
  }
  .fancyProgressBar .contain {
    display: block;
    background-color: #fff;
    border-radius: 300px;
    overflow: hidden;
    background-size: 40px 20px;
    background-position: -2px 0px;
  }
  .fancyProgressBar p{
    margin: 0;
  }
  .progressDone {
    background-color: #42b983;
    border-radius: 300px;
    height: 100%;
    text-align: left;
    text-indent: 20px;
    color: #FFFFFF;
  }
  .progressDone:after {
    content: "\0000a0";
  }
  /* change both to set the height of the progress bar and keep the text aligned in the middle */
  .fancyProgressBar .contain,
  .progressDone {
    height:      35px;
    line-height: 35px;
    padding:0;
  }
  .percent{
    position: absolute;
    top:0;
  }

</style>
